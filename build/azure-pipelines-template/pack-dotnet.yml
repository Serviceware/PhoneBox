parameters:
- name: projects
  type: object
  default: { }
- name: runtimeIdentifier
  type: string
  values:
  - linux-x64
  - osx-x64
  - win-x64
- name: configuration
  type: string
  values:
  - Debug
  - Release
 
steps:
- ${{ each project in parameters.projects }}:
  - task: DotNetCoreCLI@2
    displayName: 📦 Pack ${{ project }} (${{ parameters.configuration }})
    inputs:
      command: custom
      projects: src/${{ project }}
      custom: pack
      arguments: >
        --configuration ${{ parameters.configuration }}
        --no-build
        --no-restore
        --output $(Build.ArtifactStagingDirectory)/packages
        --p:RuntimeIdentifier=${{ parameters.runtimeIdentifier }}

      # Workarounds
      # --p:RuntimeIdentifier => https://github.com/dotnet/sdk/issues/13983